{% set page_title = "Junction - Appeal #" + ban.uid|string %}
{% set breadcrumb_tree = [
    ("Anathema", url_for('bans.a_front')),
    ("Appeal", url_for('bans.appeals_index')),
    ("View", url_for('bans.view_appeal', uid=ban.uid))
] %}
{% extends "content_base.html" %}
{% include "badge.html" %}
{% block head %}
    {{ super() }}
    <script type="text/javascript" src="/static/js/jquery-1.9.1-min.js"></script>
    <script type="text/javascript" src="/static/js/jquery-ui.js"></script>
    <link type="text/css" rel="stylesheet" href="/static/css/jquery-ui.css">
{% endblock %}

{% block content %}
<div style="margin: 10px; font-family: 'Droid Sans', sans-serif; font-size: 12px; position: relative;">
    <div>
        {% if not ban.active %}
            <div class="data-floater">
                <a>Ban was removed {{ ban.removal_time }} by {{ ban.remover }}</a>
            </div>
        {% endif %}
    </div>
    <div style="background-color: #f5f5f5; margin-top: 10px; margin-bottom: 15px; height: auto !important; overflow: auto;">
        {% if is_mod %}
        <div style="font-family: 'Droid Sans', sans-serif; font-size: 12px; border: 1px #c3c3c3 dotted; margin: 5px; display: block; float: right; background-color: rgba(255, 255, 255, 0.2);">
            <table>
                <tr>
                    <td>
                        Unlock:
                    </td>
                    <td>
                        <input class="datepicker" id="unlock_date" type="text">
                    </td>
                    <td>
                        <input id="unlock_date_set" type="submit" value="Set">
                    </td>
                    <td>
                        <input id="unlock_date_remove" type="submit" value="Remove">
                    </td>
                </tr>
                <tr>
                    <td>
                        Remove ban:
                    </td>
                    <td>
                        <input class="datepicker" id="unban_date" type="text">
                    </td>
                    <td>
                        <input id="unban_date_set" type="submit" value="Set">
                    </td>
                    <td>
                        <input id="unban_date_remove" type="submit" value="Remove">
                    </td>
                </tr>
            </table>
            <input id="unban" type="submit" value="Unban Now">
        </div>
        <div style="width: 650px;">
            {% if locked %}
            <a>Appeal is locked.</a>
            <br>
            {% endif %}
            <a>Banned by {{ ban.issuer }} with the reason:</a>
            <i>{{ ban.reason }}</i>
            <br>
        </div>
        {% endif %}
    </div>
    {% for reply in replies %}
        {% if not reply.hidden or current_user.has_permission('bans.appeal.show_hidden') %}
            <div id="{{ reply.uid }}" style="position: relative; background-color: #eeeeee; margin-top: 10px; margin-bottom: 10px; padding: 10px; border-radius: 3px; border: solid; border-width: 1px; border-color: #eaeaea;">
                {% if reply.hidden %}
                    ((HIDDEN))
                {% endif %}
                <a href="#{{ reply.uid }}" style="position: absolute; top: 5px; left: auto; right: 5px; color: #5897fb;">#{{ reply.uid }}</a>
                {% if is_mod %}
                <a href="{{ url_for('bans.edit_reply', uid=reply.uid) }}" style="position: absolute; bottom: 5px; left: auto; right: 5px; color: #5897fb;">Edit</a>
                {% endif %}
                <div style="float: left; width: 100px;">
                    <img src="{{ url_for('avatar.get_avatar', name=reply.creator.name) }}" style="width: 100px; height: 100px;">
                    {{ reply.creator.name }} <br>
                    {% if reply.creator.name|lower == ban.issuer|lower %}
                    Ban Issuer
                    {% elif reply.creator.name|lower == ban.username|lower %}
                    Ban Appealer
                    {% endif %}
                    {% if current_user.has_permission("badge.moderator") %}
                    <br>Moderator
                    {% endif %}
                </div>
                <div style="float: left; margin-left: 10px; max-width: 750px;">
                    {{ reply.text }}
                </div>
                {% if reply.edited is not none %}
                <div style="position: absolute; bottom: 3px; left: 120px; color: #aa6655;">
                    Last edit by: {{ reply.editor.name }} - {{ reply.edited.strftime("%H:%M %d %b %Y") }}
                </div>
                {% endif %}
                <div style="display: block; clear: both;"></div>
            </div>
        {% endif %}
    {% endfor %}
    {% if is_mod or (current_user.name|lower == ban.username|lower and not locked) %}
    <form method="post" action="{{ url_for('bans.post_appeal_reply', uid=ban.uid) }}">
        {{ reply_form.text(style="width: 99%; height: 100px;") }}
        {{ reply_form.submit }}
    </form>
    {% endif %}
</div>
<script>
    $(function() {
        $('.datepicker').datepicker({'minDate' : 0});
    });
</script>
{% endblock %}